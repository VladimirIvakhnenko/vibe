# Прототип системы рекомендаций музыки "Vibe"

Это прототип системы музыкальных рекомендаций, разработанный как часть проекта "Vibe". Система использует графовую модель для представления связей между треками и предпочтениями пользователя, чтобы генерировать персонализированные рекомендации.

## Архитектура

Система построена на **Spring Boot** и использует графовую базу данных **JGraphT** для хранения и обработки информации о треках и их взаимосвязях.

### Ключевые компоненты:

-   **`TrackGraph`**: Граф, где вершины — это треки (`Track`), а рёбра представляют собой связи между ними (например, "один и тот же исполнитель", "похожий жанр"). Вес ребра динамически меняется в зависимости от действий пользователя.
-   **`UserPreference`**: Хранилище лайков и дизлайков пользователя. Так как система рассчитана на одного пользователя, реализована как синглтон.
-   **`RecommendationService`**: Ядро системы. Генерирует рекомендации, используя обход графа в ширину (BFS) от топ-10 лайкнутых треков.
-   **`LikeService`**: Обрабатывает лайки, дизлайки и прослушивания, обновляя веса рёбер в `TrackGraph`.
-   **`RecommendationController`**: REST-контроллер, предоставляющий API для взаимодействия с системой.

### Алгоритм рекомендаций:

1.  Берутся **топ-10** последних лайкнутых треков пользователя.
2.  От каждого из этих треков запускается **обход в ширину (BFS)** на глубину до 2.
3.  Для каждого найденного трека рассчитывается **рейтинг**, основанный на сумме весов рёбер, ведущих к нему.
4.  Из списка кандидатов **исключаются** треки, которые пользователь уже лайкнул или дизлайкнул.
5.  Результат сортируется по рейтингу, и из **топ-20** треков случайным образом выбираются 10.
6.  К финальному списку применяется **"случайный сдвиг"**, чтобы добавить больше непредсказуемости.

## API Endpoints

Все эндпоинты работают с одним пользователем, поэтому `userId` не требуется.

### 1. Лайк / Дизлайк трека

Обрабатывает лайк или дизлайк. При лайке вес связи между этим треком и другими связанными треками увеличивается на **+1.0**. При дизлайке — уменьшается на **-1.0**.

-   **URL**: `/api/recommendations/like`
-   **Method**: `POST`
-   **Body**:
    ```json
    {
      "trackId": "track_id_here",
      "isLike": true
    }
    ```
    -   `trackId` (string, required): ID трека.
    -   `isLike` (boolean, required): `true` для лайка, `false` для дизлайка.

### 2. Полное прослушивание трека

Регистрирует полное прослушивание трека. Вес связи между этим треком и другими связанными треками увеличивается на **+0.5**.

-   **URL**: `/api/recommendations/listen`
-   **Method**: `POST`
-   **Body**:
    ```json
    {
      "trackId": "track_id_here"
    }
    ```

### 3. Получение рекомендаций

Возвращает список из 10 рекомендованных треков.

-   **URL**: `/api/recommendations`
-   **Method**: `GET`
-   **Success Response (200 OK)**:
    ```json
    {
      "tracks": [
        {
          "id": "track_id_1",
          "name": "Track Name 1",
          "artist": "Artist 1"
        },
        {
          "id": "track_id_2",
          "name": "Track Name 2",
          "artist": "Artist 2"
        }
      ]
    }
    ```

## Как запустить и протестировать

1.  **Сборка проекта**:
    ```bash
    ./gradlew build
    ```
2.  **Запуск приложения**:
    ```bash
    java -jar build/libs/vibe-0.0.1-SNAPSHOT.jar
    ```
    Приложение запустится на `localhost:8080`.

### Пример сценария тестирования

Используйте `curl` или любой другой API-клиент для отправки запросов.

1.  **Лайкнем несколько треков одного исполнителя (Queen), чтобы создать предпочтение.**
    ```bash
    curl -X POST -H "Content-Type: application/json" -d '{"trackId": "t1", "isLike": true}' http://localhost:8080/api/recommendations/like
    curl -X POST -H "Content-Type: application/json" -d '{"trackId": "t2", "isLike": true}' http://localhost:8080/api/recommendations/like
    ```

2.  **Запросим рекомендации.**
    В ответе мы должны увидеть другие треки Queen (`t3`, `t4`), так как система "поняла" наш вкус.
    ```bash
    curl http://localhost:8080/api/recommendations
    ```

3.  **Поставим дизлайк одному из рекомендованных треков.**
    ```bash
    curl -X POST -H "Content-Type: application/json" -d '{"trackId": "t3", "isLike": false}' http://localhost:8080/api/recommendations/like
    ```

4.  **Снова запросим рекомендации.**
    Теперь трек `t3` должен исчезнуть из рекомендаций.
    ```bash
    curl http://localhost:8080/api/recommendations
    ```
5.  **Зарегистрируем прослушивание трека другого исполнителя (AC/DC).**
     Это немного повысит его шансы на попадание в рекомендации.
     ```bash
     curl -X POST -H "Content-Type: application/json" -d '{"trackId": "t5"}' http://localhost:8080/api/recommendations/listen
     ```

6.  **Снова запросим рекомендации.**
    Результат может измениться, так как веса в графе были обновлены.
    ```bash
    curl http://localhost:8080/api/recommendations
    ``` 